<% layout('layouts/boilerplate')%>

<link rel="stylesheet" href="/stylesheets/stars.css">
<div class="row">

    <div class="">
        <div class="col-10 p-2">
            <span class="card-title display-5"><%= place.title%></span>
            <span class="text-muted px-1">- <%= place.location%></span>
        </div>
    </div>

     <!-- blog title
            blog subtitle
            blog intro
            blog paragrap1-4
            blog outro -->

    <div class="col-7">
        <div class="card mb-3">

            <div id="placeCarousel" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner">
                    <% place.images.forEach((img, i) => {  %>
                    <div class="carousel-item <%= i === 0 ? 'active' : ''%>">
                        <img src="<%= img.url%>" class="d-block w-100" alt="">
                    </div>
                    <% }) %>
                </div>
                <% if(place.images.length > 1) {%>
                <a class="carousel-control-prev" href="#placeCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#placeCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
                <% } %>
            </div>

            <div class="card-body">
                <!-- change this to blog title -->
                <h5 class="h2 text-uppercase"><%= place.blogTitle%></h5>
                <h5 class="h6"><%= place.publishDate%></h5>
                <p class="text-muted">Submitted by <%= place.author.username%></p>
                <!-- change this to blog intro -->
                <p class="h6"><%= place.blogIntro%></p>
                <hr>
                <!-- make this a variable for blog quote and add one for quote author -->
                <figure class="text-center">
                    <blockquote class="blockquote">
                        <p><%= place.blogQuote%></p>
                      <!-- <p>A well-known quote, contained in a blockquote element. Lorem ipsum dolor sit amet consectetur, adipisicing elit. Voluptas iure reiciendis blanditiis alias nam modi repellat eius, cumque sint aut qui eaque saepe distinctio laboriosam. Laudantium ad reiciendis harum culpa.</p> -->
                    </blockquote>
                    <figcaption class="blockquote-footer">
                      <!-- Someone famous in <cite title="Source Title">Source Title</cite> -->
                      <%= place.quoteAuthor%><cite title="Source Title"><%= place.quoteSource%></cite>
                    </figcaption>
                  </figure>
            </div>

            <!-- change this to blog body - make each paragraph a variable - prob up to six paragraphs that can be left empty -->
            <div class="card-body">
                <p><%= place.blogP1%></p>
                <p><%= place.blogP2%></p>
                <p><%= place.blogP3%></p>
                <p><%= place.blogP4%></p>
                <p><%= place.blogP5%></p>
                <p class="text-muted"><%= place.blogP6%></p>

                <!-- <p></p>
                <p></p>
                <p>
                </p>
                <p class="text-muted"></p> -->
            </div>

        </div>

    </div>

    
    <div class="card col-5 mb-3">
        <ul class="list-group list-group-flush pt-3">
            <!-- <%  if( currentUser && place.author.equals(currentUser._id))  {%>
                <div class="card-body ml-auto">
                    <a class="card-link btn btn-info" href="/places/<%=place._id%>/edit">Edit</a>
                    <form class="d-inline" action="/places/<%=place._id%>?_method=DELETE" method="POST">
                        <button class="btn btn-danger">Delete</button>
                    </form>
                </div>
                <% } %> -->
                
                <div id='map'></div>
                
                <li class="list-group-item  d-flex justify-content-between">
                    <span> <%= place.location%> </span>
                    <!-- <span class=" text-right text-muted ">Monday, February 14, 2022</span> -->
                    <span class=" text-right text-muted font-italic"><%= place.visitDate%> </span>
                </li>

            <li class="list-group-item font-weight-bold"><%= place.title%></li>
            <li class="list-group-item"><%= place.description%> </li>
        </ul>
        
        <%  if( currentUser && place.author.equals(currentUser._id))  {%>
            <div class="card my-2">
                <div class="card-body ml-auto">
                    <a class="card-link btn btn-info" href="/places/<%=place._id%>/edit">Edit</a>
                    <form class="d-inline" action="/places/<%=place._id%>?_method=DELETE" method="POST">
                        <button class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
         <% } %>
       
        <div class="card-footer text-muted">
            Share your thoughs
        </div>

        <% if(currentUser){ %>
        <div class="col-10 offset-1">            
            <!-- <h2 class="my-2">Leave a Review</h2> -->
            <p class="mt-2">Lorem ipsum dolor sit amet consectetur adipisicing elit. Praesentium itaque hic totam, at natus mollitia deserunt fugit sit accusamus? Fugiat, repudiandae? Reiciendis similique dicta molestiae quia natus voluptas? Necessitatibus, reiciendis.</p>
        </div>
            <form action="/places/<%=place._id%>/reviews" method="POST" class="mb-3 d-flex flex-column validated-form" novalidate>
                <!-- <fieldset class="starability-basic">
                    <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked
                        aria-label="No rating." />
                    <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                    <label for="first-rate1" title="Terrible">1 star</label>
                    <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                    <label for="first-rate2" title="Not good">2 stars</label>
                    <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                    <label for="first-rate3" title="Average">3 stars</label>
                    <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                    <label for="first-rate4" title="Very good">4 stars</label>
                    <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                    <label for="first-rate5" title="Amazing">5 stars</label>
                </fieldset> -->
                <div class="mb-2">
                    <hr>
                    <h2 class="">Leave a Review</h2>
                    <label class="form-label" for="body">Please Leave a Review or Comment</label>
                    <textarea class="form-control" name="review[body]" id="body" cols="30" rows="3" required></textarea>
                    <div class="valid-feedback">
                        Looks good!
                    </div>
                </div>
                <button class="btn btn-success ml-auto">Submit</button>
            </form>
            <% } %>
            <% for(let review of place.reviews) { %>
            <div class="card mb-3 ">
                <div class="card-body">
                    <h5 class="card-title"> <%= review.author.username%></h5>
                    <!-- <p class="starability-result" data-rating="<%=review.rating%>">
                        Rated: <%= review.rating %> stars
                    </p> -->
                    <p class="card-text">Review: <%= review.body %></p>
                    <%  if( currentUser && review.author.equals(currentUser._id))  {%>
                    <form action="/places/<%=place._id%>/reviews/<%=review._id%>?_method=DELETE" method="POST">
                        <button class="btn btn-sm btn-danger">Delete</button>
                    </form>
                    <% } %>
                </div>
            </div>
            <% } %>
    </div>

</div>

<script>
    const mapToken = '<%-process.env.MAPBOX_TOKEN%>';
    const place = <%- JSON.stringify(place) %>
</script>

<script src="/javascripts/showPageMap.js"></script>